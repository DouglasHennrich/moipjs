/*! Moip.js - build date: 2013-04-23 */
var moip={creditCard:{isValid:function(t){t=t.replace(/\s+/g,""),t=t.replace(/\./g,""),t=t.replace(/\-/g,"");for(var a=0,e=2-t.length%2;t.length>=e;e+=2)a+=parseInt(t.charAt(e-1));for(var e=t.length%2+1;t.length>e;e+=2){var n=2*parseInt(t.charAt(e-1));a+=10>n?n:n-9}return 0==a%10?!0:!1},cardType:function(t){t=t.replace(/\s+/g,""),t=t.replace(".",""),t=t.replace("-","");var a=/^4\d{3}-?\d{4}-?\d{4}-?\d{4}$/,e=/^5[1-5]\d{2}-?\d{4}-?\d{4}-?\d{4}$/,n=/^3[4,7]\d{13}$/,i=/^3[0,6,8]\d{12}$/,r=/^(606282\d{10}(\d{3})?|3841\d{15})$/;return t.match(a)?{brand:"VISA"}:t.match(e)?{brand:"MASTERCARD"}:t.match(n)?{brand:"AMEX"}:t.match(i)?{brand:"DINERS"}:t.match(r)?{brand:"HIPERCARD"}:null},isSecurityCodeValid:function(t,a){var e=moip.creditCard.cardType(t);if("4"==e.brand)var n=4;else var n=3;var i=RegExp("[0-9]{"+n+"}");return a.length==n&&i.test(a)},isExpiryDateValid:function(t,a){var e=new Date,n=e.getMonth()+1,i=e.getYear()+1900,r=!1;return parseInt(a)>=i&&parseInt(t)>=n&&(r=!0),r}},calculator:{pricing:function(t){return this.buildJson(t)},buildJson:function(t){var a,e=[],n=[],r=[],c=[];if(a=this._calculateTransactionTax(t.amount,t.transaction_percentage,t.fixed),void 0!=t.antecipation_percentage&&void 0!=t.floating&&void 0!=t.installment){for(i=0;11>=i;i++)e[i]=this._calculateInstallmentValue(t.amount,i+1),n[i]=this._calculateAntecipationPercentage(a,t,i,t.amount),r[i]=this._calculateTotalTax(n[i],a),c[i]=this._calculateLiquidValue(t.amount,r[i]);return{amount:t.amount,transaction_tax:a,antecipation_percentage:n,total_tax:r,liquid_value:c,installment_value:e}}return c=this._calculateLiquidValue(t.amount,a),{amount:t.amount,transaction_tax:a,liquid_value:c}},pricingWithInterest:function(t){for(var a=[],e=[],n=[],i=[],r=[],c=[],l=1;12>=l;l++)a[l-1]=this._calculateInterestRate(t.amount,t.interest_rate,l),e[l-1]=this._calculateAmount(a[l-1],l),n[l-1]=this._calculateTransactionTax(e[l-1],t.transaction_percentage,t.fixed),i[l-1]=this._calculateAntecipationPercentage(n[l-1],t,l-1,e[l-1]),r[l-1]=this._calculateTotalTax(i[l-1],n[l-1]),c[l-1]=this._calculateLiquidValue(e[l-1],r[l-1]);return{amount:e,transaction_tax:n,antecipation_percentage:i,total_tax:r,liquid_value:c,installment_value:a}},_calculateTransactionTax:function(t,a,e){return parseFloat(((t*(a/100)+e)/100).toFixed(2))},_calculateAntecipationPercentage:function(t,a,e,n){return parseFloat((parseFloat(a.antecipation_percentage/100/30*(30+15*e-a.floating))*parseFloat(n/100-t)).toFixed(2))},_calculateTotalTax:function(t,a){return parseFloat((t+a).toFixed(2))},_calculateLiquidValue:function(t,a){return parseFloat((t/100-parseFloat(a)).toFixed(2))},_calculateInstallmentValue:function(t,a){return parseFloat((t/a/100).toFixed(2))},_calculateInterestRate:function(t,a,e){return 1==e?parseFloat(t/100):parseFloat((this._coefficient(a,e)*(t/100)).toFixed(2))},_calculateAmount:function(t,a){return parseFloat(100*(t*a).toFixed(2))},_coefficient:function(t,a){return parseFloat((t/100/(1-1/Math.pow(t/100+1,a))).toFixed(10))}}};