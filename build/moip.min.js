/*! Moip.js - build date: 2014-02-07 */
!function(a){var b=a.moip||{};a.moip=b,b.creditCard={isValid:function(a){a=a.replace(/\s+/g,""),a=a.replace(/\./g,""),a=a.replace(/\-/g,"");var b=this.cardType(a);if(null===b)return!1;if("HIPERCARD"===b.brand)return!0;for(var c=0,d=2-a.length%2;d<=a.length;d+=2)c+=parseInt(a.charAt(d-1),10);for(d=a.length%2+1;d<a.length;d+=2){var e=2*parseInt(a.charAt(d-1),10);c+=10>e?e:e-9}return c%10===0?!0:!1},cardType:function(a){a=a.replace(/\s+/g,""),a=a.replace(".",""),a=a.replace("-","");var b=/^4\d{3}-?\d{4}-?\d{4}-?\d{4}$/,c=/^5[1-5]\d{2}-?\d{4}-?\d{4}-?\d{4}$/,d=/^3[4,7]\d{13}$/,e=/^3[0,6,8]\d{12}$/,f=/^(606282\d{10}(\d{3})?)|(3841\d{15})$/;return a.match(b)?{brand:"VISA"}:a.match(c)?{brand:"MASTERCARD"}:a.match(d)?{brand:"AMEX"}:a.match(e)?{brand:"DINERS"}:a.match(f)?{brand:"HIPERCARD"}:null},isSecurityCodeValid:function(a,c){var d,e=b.creditCard.cardType(a);d="AMEX"===e.brand?4:3;var f=new RegExp("[0-9]{"+d+"}");return c.length===d&&f.test(c)},isExpiryDateValid:function(a,b){return a=parseInt(a,10),b=parseInt(b,10),1>a||a>12?!1:2!==(b+"").length&&4!==(b+"").length?!1:(2===(b+"").length&&(b=b>80?"19"+b:"20"+b),1e3>b||b>=3e3?!1:!this.isExpiredDate(a,b))},isExpiredDate:function(a,b){var c=new Date,d=("0"+(c.getMonth()+1)).slice(-2),e=c.getFullYear();if(a=("0"+a).slice(-2),2===b.toString().length){if(b>80)return!0;b="20"+b}var f=e+d,g=b+a;return parseInt(g,10)<parseInt(f,10)}}}(window),function(a){var b=a.moip||{};a.moip=b,b.calculator={pricing:function(a){return this.buildJson(a)},buildJson:function(a){var b,c=[],d=[],e=[],f=[];if(b=this._calculateTransactionTax(a.amount,a.transaction_percentage,a.fixed),void 0!==a.antecipation_percentage&&void 0!==a.floating&&void 0!==a.installment){for(var g=0;11>=g;g++)c[g]=this._calculateInstallmentValue(a.amount,g+1),d[g]=this._calculateAntecipationPercentage(b,a,g,a.amount),e[g]=this._calculateTotalTax(d[g],b),f[g]=this._calculateLiquidValue(a.amount,e[g]);return{amount:a.amount,transaction_tax:b,antecipation_percentage:d,total_tax:e,liquid_value:f,installment_value:c}}return f=this._calculateLiquidValue(a.amount,b),{amount:a.amount,transaction_tax:b,liquid_value:f}},pricingWithInterest:function(a){for(var b=[],c=[],d=[],e=[],f=[],g=[],h=[],i=1;12>=i;i++)b[i-1]=this._calculateInterestRate(a.amount,a.interest_rate,i),c[i-1]=this._calculateAmount(b[i-1],i),d[i-1]=this._calculateTransactionTax(c[i-1],a.transaction_percentage,a.fixed),e[i-1]=this._calculateAntecipationPercentage(d[i-1],a,i-1,c[i-1]),f[i-1]=this._calculateAntecipationPercentageFromAmount(c[i-1],e[i-1]),g[i-1]=this._calculateTotalTax(e[i-1],d[i-1]),h[i-1]=this._calculateLiquidValue(c[i-1],g[i-1]);return{amount:c,transaction_tax:d,antecipation_percentage:f,total_tax:g,liquid_value:h,installment_value:b}},_calculateAntecipationPercentageFromAmount:function(a,b){return parseFloat(100*b/(a/100)).toFixed(2)},_calculateTransactionTax:function(a,b,c){return parseFloat(((a*(b/100)+c)/100).toFixed(2))},_calculateAntecipationPercentage:function(a,b,c,d){return parseFloat((parseFloat(b.antecipation_percentage/100/30*(30+15*c-b.floating))*parseFloat(d/100-a)).toFixed(2))},_calculateTotalTax:function(a,b){return parseFloat((a+b).toFixed(2))},_calculateLiquidValue:function(a,b){return parseFloat((a/100-parseFloat(b)).toFixed(2))},_calculateInstallmentValue:function(a,b){return parseFloat((a/b/100).toFixed(2))},_calculateInterestRate:function(a,b,c){return parseFloat(1===c?a/100:(this._coefficient(b,c)*(a/100)).toFixed(2))},_calculateAmount:function(a,b){return parseFloat(100*(a*b).toFixed(2))},_coefficient:function(a,b){return parseFloat((a/100/(1-1/Math.pow(a/100+1,b))).toFixed(10))}}}(window);