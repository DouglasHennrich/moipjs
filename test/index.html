<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>MoIP Javascript Validations</title>
<link rel="stylesheet" href="qunit.css">
<script src="qunit.js"></script>
<script src="../build/moip.js"></script>
<script>
test("MoIP Credit Card Validations", function() {
	var valid = moip.creditCard.isValid("4111111111111111");
	equal(valid, true, "Cartão VISA válido sem espaços");

	valid = moip.creditCard.isValid("4222222222222");
	equal(valid, true, "Cartão VISA válido sem espaços");
	
	valid = moip.creditCard.isValid("4111 1111 1111 1111");
	equal(valid, true, "Cartão VISA válido com espaços");
	
	valid = moip.creditCard.isValid("4111.1111.1111.1111");
	equal(valid, true, "Cartão VISA válido com pontuação");
	
	valid = moip.creditCard.isValid("4111-1111-1111-1111");
	equal(valid, true, "Cartão VISA válido com hifens");

	valid = moip.creditCard.isValid("4111111111121111");
	equal(valid, false, "Cartão VISA inválido sem espaços");
	
	valid = moip.creditCard.isValid("5555666677778884");
	equal(valid, true, "Cartão MASTERCARD válido sem espaços");

	valid = moip.creditCard.isValid("5105105105105100");
	equal(valid, true, "Cartão MASTERCARD válido sem espaços");

	valid = moip.creditCard.isValid("5105105105105120");
	equal(valid, false, "Cartão MASTERCARD inválido sem espaços");

	valid = moip.creditCard.isValid("30569309025904");
	equal(valid, true, "Cartão DINERS válido sem espaços");

	valid = moip.creditCard.isValid("378282246310005");
	equal(valid, true, "Cartão AMEX válido sem espaços");

	var cscValid = moip.creditCard.isSecurityCodeValid("5105105105105100", "123");
	equal(cscValid, true);
  
  	cscValid = moip.creditCard.isSecurityCodeValid("5105105105105100", "1234");
	equal(cscValid, false);
	
	var type = moip.creditCard.cardType("5105105105105100");
	equal(type["brand"], "MASTERCARD");

	type = moip.creditCard.cardType("4111111111111111");
	equal(type["brand"], "VISA");

	type = moip.creditCard.cardType("4111 1111 1111 1111");
	equal(type["brand"], "VISA");

	type = moip.creditCard.cardType("341111111111111");
	equal(type["brand"], "AMEX");

	type = moip.creditCard.cardType("3841001111222233334");
	equal(type["brand"], "HIPERCARD");

	type = moip.creditCard.cardType("2441111111111111");
	equal(type, null);

	var now = new Date();
	var isExpiryDateValid = moip.creditCard.isExpiryDateValid(now.getMonth()+1+"", now.getYear()+1900+"");
	equal(isExpiryDateValid, true);
	
	isExpiryDateValid = moip.creditCard.isExpiryDateValid("10", "2010");
	equal(isExpiryDateValid, false);
	});

	test("MoIP Calculator Tests", function() {
		var response = moip.calculator.pricing({ 	"amount" : 10000, 
													"fixed" : 69, 
													"transaction_percentage" : 4.69, 
													"antecipation_percentage" : 2.49, 
													"floating" : 14, 
													"installment" : 4});

		equal(response.amount, 100, "Valor da transação deve ser correto");
		equal(response.antecipation_percentage.length, 12, "Taxa de antecipação deve conter 12 meses calculados");
		equal(response.liquid_value.length, 12, "Valor liquido deve conter 12 meses calculados");
		equal(response.total_tax.length, 12, "Total de taxas deve conter 12 meses calculados");

		deepEqual(response.installment_value, [100,50,33.33,25,20,16.67,14.29,12.5,11.11,10,9.09,8.33], "Valor da parcela");

		deepEqual(response.antecipation_percentage, [1.26, 2.43, 3.61, 4.79, 5.97, 7.15, 8.32, 9.5, 10.68, 11.86, 13.04, 14.21], "Valores de porcentagem de antecipação devem estar calculados corretamente");
		deepEqual(response.liquid_value, [ 106.64, 107.81, 108.99, 110.17, 111.35, 112.53, 113.7, 114.88, 116.06, 117.24, 118.42, 119.59], "Valor liquido deve estar calculado corretamente");
		deepEqual(response.total_tax, [ 6.64, 7.81, 8.99, 10.17, 11.35, 12.53, 13.70, 14.88, 16.06, 17.24, 18.42, 19.59], "Valor total deve estar calculado corretamente");


		var otherPayments = moip.calculator.pricing({ "amount" : 10000, "fixed" : 69, "transaction_percentage" : 4.69});
		equal(otherPayments.amount, 100, "Valor da transação de boleto/online/transferência deve ser correto");
		equal(otherPayments.transaction_tax, 5.38, "Taxa da transação de boleto/online/transferência deve ser correto");
		equal(otherPayments.liquid_value, 105.38, "Valor liquido da transação de boleto/online/transferência deve ser correto");

		response = moip.calculator.pricingWithInterest({ 	"amount" : 10000, 
													"fixed" : 69, 
													"transaction_percentage" : 4.69, 
													"antecipation_percentage" : 2.49, 
													"floating" : 14, 
													"installment" : 4,
													"interest_rate" : 1.99});

		deepEqual(response.amount, [100, 102.99, 104.01, 105.02, 106.05, 107.08, 108.12, 109.16, 110.21, 111.27, 112.33, 113.4] , "Valor total com juros");
		deepEqual(response.liquid_value, [106.64,107.81,108.99,110.17,111.35,112.53,113.7,114.88,116.06,117.24,118.42,119.59], "Valor liquido da transação com juros");

	});
</script>
</head>
<body>
<div id="qunit"></div>
</body>
</html>